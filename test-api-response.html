<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔍 Smartemailing API Debug</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      margin-top: 0;
      color: #333;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 14px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    #response {
      margin-top: 30px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #2563eb;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      display: none;
    }
    .success {
      border-left-color: #10b981;
      background: #f0fdf4;
    }
    .error {
      border-left-color: #ef4444;
      background: #fef2f2;
    }
    .info {
      background: #eff6ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #3b82f6;
    }
    .info-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #1e40af;
    }
    .step {
      margin: 10px 0;
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔍 Smartemailing API Response Debug</h1>
    
    <div class="info">
      <div class="info-title">📋 CO TEĎ OTESTUJEME:</div>
      <div class="step">✅ 1. Pošleme API request na Smartemailing</div>
      <div class="step">✅ 2. Zobrazíme CELOU response (včetně add_to_lists)</div>
      <div class="step">✅ 3. Ověříme jestli se kontakt přidal do listu #2</div>
    </div>
    
    <form id="testForm">
      <div class="form-group">
        <label for="email">📧 Email (použij NOVÝ email!):</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          required
          placeholder="debug.test@gmail.com"
        >
      </div>
      
      <button type="submit" id="submitBtn">
        🚀 ODESLAT API REQUEST
      </button>
    </form>
    
    <div id="response"></div>
  </div>

  <script>
    const form = document.getElementById('testForm');
    const submitBtn = document.getElementById('submitBtn');
    const responseDiv = document.getElementById('response');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      
      submitBtn.disabled = true;
      submitBtn.textContent = '⏳ ODESÍLÁM...';
      
      responseDiv.style.display = 'block';
      responseDiv.className = '';
      responseDiv.textContent = '⏳ Čekám na odpověď z Smartemailing API...';
      
      try {
        const response = await fetch('/.netlify/functions/smartemailing-subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            email,
            name: 'Debug Test'
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          responseDiv.className = 'success';
          responseDiv.textContent = '✅ SUCCESS!\n\n' + 
            '📊 FULL API RESPONSE:\n' +
            JSON.stringify(data, null, 2) +
            '\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n' +
            '🔍 CO KONTROLOVAT VE SMARTEMAILINGU:\n\n' +
            '1. ✅ Jdi na: app.smartemailing.cz\n' +
            '2. ✅ Kontakty → VŠECHNY KONTAKTY (ne jen list!)\n' +
            '3. ✅ Hledej email: ' + email + '\n' +
            '4. ✅ Zkontroluj v jakých listech je\n\n' +
            (data.contactId ? `Contact ID: ${data.contactId}\n` : '') +
            (data.status ? `Status: ${data.status}\n` : '');
        } else {
          responseDiv.className = 'error';
          responseDiv.textContent = '❌ ERROR!\n\n' + JSON.stringify(data, null, 2);
        }
      } catch (error) {
        responseDiv.className = 'error';
        responseDiv.textContent = '❌ NETWORK ERROR!\n\n' + error.message;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '🚀 ODESLAT API REQUEST';
      }
    });
  </script>
</body>
</html>
