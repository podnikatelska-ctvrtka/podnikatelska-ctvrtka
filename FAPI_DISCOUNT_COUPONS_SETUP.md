# ğŸ’° FAPI DISCOUNT KUPONY - SETUP GUIDE

Jak nastavit slevovÃ© kupony ve FAPI.cz pro 24hodinovou slevu 40%.

---

## ğŸ¯ **CO POTÅ˜EBUJEME**

1. **SlevovÃ½ kupÃ³n** "EARLY40" (-40%)
2. **Auto-aplikace** pÅ™i kliknutÃ­ z emailu
3. **Time-limited** (24h od vytvoÅ™enÃ­)
4. **One-time use** (nelze zneuÅ¾Ã­t)

---

## âš™ï¸ **NASTAVENÃ V FAPI**

### **1. VytvoÅ™enÃ­ produktu (pokud jeÅ¡tÄ› nemÃ¡Å¡)**

1. PÅ™ihlaÅ¡ se do FAPI â†’ **Produkty**
2. Klikni **"PÅ™idat produkt"**
3. VyplÅˆ:
   ```
   NÃ¡zev: PodnikatelskÃ¡ ÄŒtvrtka
   Cena: 4.999 KÄ (bez DPH)
   Typ: Kurz / Online produkt
   ```
4. **UloÅ¾**

---

### **2. VytvoÅ™enÃ­ slevovÃ©ho kupÃ³nu**

1. V FAPI â†’ **Marketing** â†’ **KupÃ³ny**
2. Klikni **"PÅ™idat kupÃ³n"**
3. VyplÅˆ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZÃKLADNÃ NASTAVENÃ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ KÃ³d kupÃ³nu: EARLY40                     â”‚
â”‚ NÃ¡zev (internÃ­): PrÅ¯kopnickÃ¡ sleva 40%  â”‚
â”‚ Typ slevy: ProcentuÃ¡lnÃ­                 â”‚
â”‚ Hodnota: 40 (%)                          â”‚
â”‚ Min. ÄÃ¡stka: - (Å¾Ã¡dnÃ¡)                  â”‚
â”‚ Max. pouÅ¾itÃ­: 50 (nebo neomezeno)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLATNOST                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Platnost od: 27.1.2025 09:00            â”‚
â”‚ Platnost do: - (nastavÃ­me dynamicky)    â”‚
â”‚ ÄŒasovÄ› omezenÃ½: ANO (24h od pouÅ¾itÃ­)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OMEZENÃ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PouÅ¾itÃ­ na 1 email: 1Ã— (one-time)      â”‚
â”‚ Produkty: PodnikatelskÃ¡ ÄŒtvrtka         â”‚
â”‚ Auto-aplikace: ANO âœ…                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

4. **UloÅ¾ kupÃ³n**

---

### **3. Auto-aplikace kupÃ³nu v URL**

FAPI umÃ­ automaticky aplikovat kupÃ³n pokud je v URL:

```
https://podnikatelskactvrtka.cz/objednavka?discount=EARLY40
```

**Nebo pokud pouÅ¾Ã­vÃ¡Å¡ FAPI embed:**

```
https://fapi.cz/checkout/TVOJE-PRODUKT-ID?coupon=EARLY40
```

**V emailu pouÅ¾ij:**

```html
<a href="https://podnikatelskactvrtka.cz/objednavka?discount=EARLY40&email={{email}}">
  Ano, chci kurz se slevou 40%
</a>
```

FAPI automaticky:
1. ZjistÃ­ Å¾e URL obsahuje `?discount=EARLY40`
2. Aplikuje slevu 40%
3. ZobrazÃ­ uÅ¾ivateli jiÅ¾ snÃ­Å¾enou cenu
4. OznaÄÃ­ kupÃ³n jako "pouÅ¾itÃ½" pro danÃ½ email

---

## ğŸ• **ÄŒASOVÄš OMEZENÃ KUPÃ“N (24h)**

### **PROBLÃ‰M:**
FAPI neumÃ­ nativnÄ› "24h od registrace" - jen globÃ¡lnÃ­ platnost.

### **Å˜EÅ ENÃ A: ManuÃ¡lnÃ­ batch (jednoduchÃ©)**

VytvoÅ™ **50 unikÃ¡tnÃ­ch kupÃ³nÅ¯** s 24h platnostÃ­ od spuÅ¡tÄ›nÃ­ kampanÄ›:

```
EARLY40-DAY1 (platnost: 27.1. 09:00 - 28.1. 09:00)
EARLY40-DAY2 (platnost: 28.1. 09:00 - 29.1. 09:00)
EARLY40-DAY3 (platnost: 29.1. 09:00 - 30.1. 09:00)
...
```

KaÅ¾dÃ½ den poÅ¡leÅ¡ emails s novÃ½m kupÃ³nem.

**VÃHODY:**
- âœ… JednoduchÃ© nastavenÃ­
- âœ… Funguje nativnÄ› v FAPI

**NEVÃHODY:**
- âŒ ManuÃ¡lnÃ­ prÃ¡ce kaÅ¾dÃ½ den
- âŒ KupÃ³n platÃ­ pro vÅ¡echny (ne individuÃ¡lnÄ›)

---

### **Å˜EÅ ENÃ B: DynamickÃ½ kupÃ³n pÅ™es API (advanced)**

PouÅ¾ij FAPI API + Netlify Function k vytvoÅ™enÃ­ **individuÃ¡lnÃ­ho kupÃ³nu** pro kaÅ¾dÃ©ho uÅ¾ivatele:

```javascript
// netlify/functions/create-dynamic-coupon.js

exports.handler = async (event) => {
  const { email } = JSON.parse(event.body);
  
  // VytvoÅ™ unikÃ¡tnÃ­ kupÃ³n pro tento email
  const couponCode = `EARLY40-${email.replace('@', '-').replace('.', '-')}`;
  
  // VypoÄti expiraci (24h od teÄ)
  const expiresAt = new Date();
  expiresAt.setHours(expiresAt.getHours() + 24);
  
  // VytvoÅ™ kupÃ³n pÅ™es FAPI API
  const response = await fetch('https://api.fapi.cz/coupons', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.FAPI_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      code: couponCode,
      discount: 40, // 40%
      type: 'percentage',
      expires_at: expiresAt.toISOString(),
      max_uses: 1,
      email_restriction: email,
    }),
  });
  
  const coupon = await response.json();
  
  return {
    statusCode: 200,
    body: JSON.stringify({ 
      couponCode: coupon.code,
      expiresAt: expiresAt.toISOString() 
    }),
  };
};
```

**Pak v SmartEmailing emailu:**

```
[CTA: "Chci kurz se slevou"]
â†’ Link: https://podnikatelskactvrtka.cz/objednavka?discount={{custom_coupon_code}}
```

**VÃHODY:**
- âœ… IndividuÃ¡lnÃ­ 24h platnost pro kaÅ¾dÃ©ho
- âœ… PÅ™esnÃ½ tracking

**NEVÃHODY:**
- âŒ SloÅ¾itÄ›jÅ¡Ã­ setup (API + Netlify Function)
- âŒ PotÅ™ebujeÅ¡ FAPI API pÅ™Ã­stup

---

### **Å˜EÅ ENÃ C: Frontend timer (nejjednoduÅ¡Å¡Ã­!) â­**

PouÅ¾ij **frontend countdown** na `/objednavka` strÃ¡nce:

```typescript
// /components/OrderPageFinal.tsx

const checkCouponValidity = () => {
  // Zjisti kdy se uÅ¾ivatel registroval (z localStorage nebo URL param)
  const registeredAt = localStorage.getItem('registered_at');
  
  if (!registeredAt) return false;
  
  const registered = new Date(registeredAt);
  const now = new Date();
  const hoursSince = (now - registered) / (1000 * 60 * 60);
  
  // Pokud je vÃ­c neÅ¾ 24h = sleva vyprÅ¡ela
  if (hoursSince > 24) {
    return false; // VyprÅ¡elo
  }
  
  return true; // StÃ¡le platnÃ©
};

// Zobraz countdown
const timeRemaining = calculateTimeRemaining(registeredAt);

// Pokud vyprÅ¡Ã­ = skryj slevu
{checkCouponValidity() ? (
  <div>
    <p>â° Sleva vyprÅ¡Ã­ za: {timeRemaining}</p>
    <p>Cena: 4.999 KÄ (sleva 40%)</p>
  </div>
) : (
  <div>
    <p>âš ï¸ Sleva vyprÅ¡ela!</p>
    <p>Cena: 8.332 KÄ</p>
  </div>
)}
```

**VÃHODY:**
- âœ… NejjednoduÅ¡Å¡Ã­ implementace
- âœ… Funguje bez API
- âœ… VizuÃ¡lnÃ­ countdown = FOMO efekt

**NEVÃHODY:**
- âŒ Frontend validace = lze obejÃ­t (F12 console)
- âŒ PotÅ™ebujeÅ¡ backend validaci (FAPI webhook)

---

## ğŸ¯ **DOPORUÄŒENÃ: HYBRID APPROACH**

Kombinace **Å˜eÅ¡enÃ­ A + C**:

1. **FAPI:** VytvoÅ™ 1 globÃ¡lnÃ­ kupÃ³n `EARLY40` (40%, platnost 7 dnÃ­)
2. **Frontend:** Countdown timer na `/objednavka` (24h od registrace)
3. **Backend:** FAPI webhook kontroluje `registered_at` timestamp

```
UÅ¾ivatel klikne z emailu â†’ URL obsahuje ?discount=EARLY40&registered_at=2025-01-27T09:00:00
                         â†“
Frontend zkontroluje Äasovou platnost (24h)
                         â†“
          PlatnÃ©?        |       VyprÅ¡elÃ©?
             â†“                      â†“
    Zobraz slevu 40%        Zobraz plnou cenu
    (4.999 KÄ)              (8.332 KÄ)
             â†“                      â†“
    FAPI webhook                ZamÃ­tni kupÃ³n
    validuje timestamp          (error message)
```

**VÃSLEDEK:**
- âœ… JednoduchÃ© nastavenÃ­ (1 kupÃ³n v FAPI)
- âœ… VizuÃ¡lnÃ­ countdown (FOMO efekt)
- âœ… Backend validace (zabezpeÄenÃ©)

---

## ğŸ“§ **INTEGRACE DO EMAILÅ®**

### **Email #1 (0h):**

```
Tady je tvoje sleva 40%:

[CTA: "Ano, chci kurz se slevou"]
â†’ Link: https://podnikatelskactvrtka.cz/objednavka?discount=EARLY40&registered_at={{registered_at}}

â° Sleva vyprÅ¡Ã­ za 24 hodin!
```

### **Email #2 (+20h):**

```
â° ZbÃ½vÃ¡ 4 hodiny na slevu!

[CTA: "Nechci promeÅ¡kaÅ¥"]
â†’ Link: https://podnikatelskactvrtka.cz/objednavka?discount=EARLY40&registered_at={{registered_at}}
```

---

## ğŸ”§ **FAPI WEBHOOK VALIDACE**

KdyÅ¾ uÅ¾ivatel objednÃ¡, FAPI poÅ¡le webhook do:

```
POST https://podnikatelskactvrtka.cz/.netlify/functions/fapi-webhook
```

**Validuj timestamp:**

```javascript
// netlify/functions/fapi-webhook.js

exports.handler = async (event) => {
  const { coupon_code, customer_email, custom_fields } = JSON.parse(event.body);
  
  // Zjisti kdy se registroval
  const registeredAt = custom_fields.registered_at; // "2025-01-27T09:00:00"
  
  if (!registeredAt) {
    // Å½Ã¡dnÃ½ timestamp = zamÃ­tni kupÃ³n
    return {
      statusCode: 400,
      body: JSON.stringify({ error: 'ChybÄ›jÃ­cÃ­ registraÄnÃ­ timestamp' }),
    };
  }
  
  const registered = new Date(registeredAt);
  const now = new Date();
  const hoursSince = (now - registered) / (1000 * 60 * 60);
  
  if (hoursSince > 24) {
    // VÃ­c neÅ¾ 24h = sleva vyprÅ¡ela
    return {
      statusCode: 400,
      body: JSON.stringify({ error: 'Sleva vyprÅ¡ela!' }),
    };
  }
  
  // OK, sleva platÃ­!
  return {
    statusCode: 200,
    body: JSON.stringify({ success: true }),
  };
};
```

---

## âœ… **CHECKLIST**

- [ ] VytvoÅ™it produkt v FAPI (PodnikatelskÃ¡ ÄŒtvrtka, 4.999 KÄ)
- [ ] VytvoÅ™it kupÃ³n `EARLY40` (40%, platnost 7 dnÃ­)
- [ ] Nastavit auto-aplikaci v URL (`?discount=EARLY40`)
- [ ] PÅ™idat `registered_at` do URL parametrÅ¯
- [ ] Implementovat countdown timer na `/objednavka`
- [ ] Nastavit FAPI webhook validaci
- [ ] Otestovat celÃ½ flow (registrace â†’ email â†’ objednÃ¡vka)

---

**READY TO SELL! ğŸ’°**
